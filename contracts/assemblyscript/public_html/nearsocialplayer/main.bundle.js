import"https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.3/pako.min.js";async function e(e,t){return await fetch("https://rpc.mainnet.near.org",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:"dontcare",method:"query",params:{request_type:"call_function",finality:"final",account_id:"psalomo.near",method_name:e,args_base64:btoa(JSON.stringify({token_id:"2"}))}})}).then((e=>e.json())).then((e=>JSON.parse(e.result.result.map((e=>String.fromCharCode(e))).join(""))))}function t(e){document.getElementById("loadercontainer").style.display=e?"flex":"none"}const a=await e("nft_token");document.getElementById("ownerspan").innerHTML=a.owner_id;const n=await e("view_token_content_base64"),r=await async function(e){return pako.ungzip(function(e){for(var t=window.atob(e),a=t.length,n=new Uint8Array(a),r=0;r<a;r++)n[r]=t.charCodeAt(r);return n.buffer}(e.replaceAll(/\"/g,"")))}(n),s=new Worker(URL.createObjectURL(new Blob([(()=>{const e=function(){onmessage=async e=>{if(e.data.wasm){const o=e.data.samplerate,i=WebAssembly.instantiate(e.data.wasm,{environment:{SAMPLERATE:o}}),l=(await i).instance.exports,c=e.data.patternschedule;if(c)for(let e=0;e<c.length;e++)l.setMidiPartSchedule(e,c[e].patternindex,c[e].starttime);const d=e.data.songduration,u=128,m=new Float32Array(l.memory.buffer,l.samplebuffer,u),p=new Float32Array(l.memory.buffer,l.samplebuffer+4*u,u),f=100,w=32,y=2;var t=w/8,a=y*t;const g=y*t*(.001*d*o+f*u);var n=new ArrayBuffer(44+g),r=new DataView(n);function s(e,t,a){for(var n=0;n<a.length;n++)e.setUint8(t+n,a.charCodeAt(n))}s(r,0,"RIFF"),r.setUint32(4,36+g,!0),s(r,8,"WAVE"),s(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,3,!0),r.setUint16(22,y,!0),r.setUint32(24,o,!0),r.setUint32(28,o*a,!0),r.setUint16(32,a,!0),r.setUint16(34,w,!0),s(r,36,"data"),r.setUint32(40,g,!0);let h=44;for(;l.currentTimeMillis.value<d;){for(let e=0;e<f;e++){l.playEventsAndFillSampleBuffer();for(let e=0;e<u;e++)r.setFloat32(h,m[e],!0),h+=4,r.setFloat32(h,p[e],!0),h+=4}postMessage({exportWavPosition:l.currentTimeMillis.value,progress:l.currentTimeMillis.value/d}),await new Promise((e=>setTimeout(e,0)))}postMessage({musicdata:n},[n])}}}.toString();return e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))})()],{type:"text/javascript"})));t(!0);const o=await new Promise((async e=>{s.postMessage({wasm:r,samplerate:44100,songduration:6e4}),s.onmessage=t=>{t.data.musicdata?e(t.data.musicdata):document.querySelector("#loaderprogress").innerHTML=(100*t.data.progress).toFixed(2)+"%"}}));t(!1);const i=await new Promise((e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(new Blob([o],{type:"audio/wav"}))})),l=document.getElementById("player"),c=document.createElement("source");c.src=i,c.type="audio/wav",l.appendChild(c);
